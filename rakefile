require 'rake/clean'
require 'rubygems'
require 'fruit_processor'

include Rake::DSL if defined?(Rake::DSL)

$base_dir=Dir.pwd
$build_dir = "#{$base_dir}/build"

task :default => [:in_3_minutes, :anchor_root, :dirs, :compile, :test, :sample]

CLEAN.include(FileList['**/*.o', '**/*.mod', '**/*.a', '**/*_gen.f90', '**/*fruit_driver', 
  '**/result*.xml', 'in_3_minutes/fruit.f90', 'in_3_minutes/fruit_util.f90' ])
CLOBBER.include($build_dir)

task :compile do
  sh 'cd src;rake'
end

task :test => :compile do
  sh 'cd test;rake;'
  driver_programs = FileList["#{$build_dir}/fruit_driver"]
  driver_programs.each do |driver|
    sh "\"#{driver}\""
  end
end

task :sample => :compile do
  sh 'cd sample;rake;'
  sh "cd \"#{$build_dir}\";./fruit_driver"
end

task :in_3_minutes do
  sh 'cd in_3_minutes;rake'
end

load 'rake_base.rb'
include RakeBase
