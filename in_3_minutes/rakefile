require 'rubygems'
require 'fruit_processor'

include Rake::DSL if defined?(Rake::DSL)

$build_dir = "."
$goal = "fruit_driver_3min.exe"

task :default => [:test]

task :test => [:clean] do
  #following the procedure in "Add Fruit to Your Diet in 3 Minutes"
  os_install("../src/fruit.f90", "fruit.f90")
  os_install("../src/fruit_util.f90", "fruit_util.f90")
  sh "#{$compiler} #{$option} -c fruit_util.f90"
  sh "#{$compiler} #{$option} -c fruit.f90"
  sh "#{$compiler} #{$option} -c calculator.f90"
  sh "#{$compiler} #{$option} -c calculator_test.f90"
  sh "#{$compiler} #{$option} -c fruit_driver.f90"
  sh "#{$compiler} #{$option} -o #{$goal} *.o"
  sh "./#{$goal}"
end

task :clean do
  sh "rm -f fruit.f90"
  sh "rm -f fruit_util.f90"
  sh "rm -f #{$goal}"
end

load '../rake_base.rb'
include RakeBase
