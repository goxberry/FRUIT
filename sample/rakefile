require 'rubygems'
require 'fruit_processor'

include Rake::DSL if defined?(Rake::DSL)


task :compile do
  Dir.chdir("src") { 
    sh 'rake'
  }
end

task :test => :compile do
  rake_opt = ""
  result_which = `which ar 2>&1`
  rake_opt = " -f rakefile_mingw " if $?.to_i != 0
  Dir.chdir("test") { 
    sh "rake #{rake_opt} test"
  }
end

task :valgrind => :compile do
  Dir.chdir("test") { 
    sh 'rake'
    sh 'valgrind --leak-check=full ./calculator_fruit_driver'
 }
end

load "#{FruitProcessor.new.base_dir}/rake_base.rb"
include RakeBase

task :default => [:test]
